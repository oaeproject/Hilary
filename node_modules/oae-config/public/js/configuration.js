    //////////////////////
    //// DATA STORING ////
    //////////////////////

    /**
     * Writes the configuration changes for a tenant/global to Cassandra
     */
    var writeConfig = function(form, adminContext) {
        var data = {};
        $.each($(form).context, function(index, item) {
            if ($(item).attr('data-tenantId') && $(item).is(':visible')) {
                if ($(item).attr('data-elementType') === 'arraymultiplechoice') {
                    var itemId = $(item).attr('id').split('/');
                    var configId = itemId[0] + '/' + itemId[1] + '/' + itemId[2];
                    data[configId] = data[configId] || {};
                    if ($(item).is(':checked')) {
                        data[configId][itemId[3]] = data[configId][itemId[3]] || [];
                        data[configId][itemId[3]].push(itemId[4]);
                    }
                } else if ($(item).attr('data-elementType') === 'expandablearray') {
                    var itemId = $(item).attr('id').split('/');
                    var configId = itemId[0] + '/' + itemId[1] + '/' + itemId[2];
                    data[configId] = data[configId] || {};
                    data[configId][itemId[3]] = data[configId][itemId[3]] || {};
                    data[configId][itemId[3]][itemId[4]] = data[configId][itemId[3]][itemId[4]] || {};
                    if ($(item).attr('type') === 'text') {
                        data[configId][itemId[3]][itemId[4]].defaultValue = $(item).val();
                    } else if ($(item).attr('type') === 'checkbox') {
                        data[configId][itemId[3]][itemId[4]].defaultValue = $(item).is(':checked');
                    }
                    if ($(item).attr('disabled')) {
                        data[configId][itemId[3]].disabled = true;
                    }
                } else if ($(item).attr('type') === 'text') {
                    data[$(item).attr('id')] = $(item).val();
                } else if ($(item).attr('type') === 'checkbox') {
                    if ($(item).is(':checked') + '' != $(item).attr('data-originalvalue')) {
                        data[$(item).attr('id')] = $(item).is(':checked');
                    }
                } else if ($(item).attr('type') === 'radio') {
                    if ($(item).is(':checked')) {
                        data[$(item).attr('data-id')] = $(item).val();
                    }
                } else if ($(item).children('option').length) {
                    data[$(item).attr('id')] = $(item).val();
                }
            }
        });

        // Check for configuration that needs to be saved but is not necessarily displayed in the form of an input field
        $.each($(form).find('.tree_container'), function(i, tree) {
            var itemId = $(tree).attr('id').split('_');
            var configId = itemId[0] + '/' + itemId[1] + '/' + itemId[2];
            var treeData = $.tree.datastores.json().get(null, $.tree.reference($(tree)));
            data[configId] = data[configId] || treeData;
        });

        var url = '/api/config';

        // Tenant and global servers do not need the tenantId to be specified in the URL
        // If a tenant server is accessed through the global server the tenantId needs to be specified
        if (!adminContext.tenant.isMainTenantServer) {
            url += '/' + adminContext.tenant.tenantId;
        }

        if (!$.isEmptyObject(data)) {
            $.ajax({
                url: url,
                type: 'POST',
                data: data,
                success: function() {
                    $.each(data, function(i, item){
                        $('#' + i.replace(/\//g, '\\/')).attr('data-originalvalue', item);
                    });
                    showSuccess({
                        'title': 'Configuration saved.',
                        'message': 'The configuration was successfully saved.'
                    });
                }, error: function() {
                    showError({
                        'title': 'Configuration not saved.',
                        'message': 'The configuration could not be saved successfully.'
                    });
                }
            });
        }
        return false;
    };

    /**
     * Creates a new tenant and starts it up immediately
     * @param  {Function}  callback  A function that executes after the tenant has been created.
     */
    var createTenant = function(callback) {
        $.ajax({
            url: '/api/tenant/create',
            type: 'POST',
            data: {
                'id': $('#createtenant_id').val(),
                'name': $('#createtenant_name').val(),
                'port': $('#createtenant_port').val(),
                'baseurl': $('#createtenant_baseurl').val()
            },
            success: function(data) {
                if ($.isFunction(callback)) {
                    callback(data);
                }
            }
        });
    };

    /**
     * Deletes a tenant server
     * @param {Object}    tenants    Array of tenants to be deleted
     * @param {Function}  callback   Executed after the tenants have been deleted
     */
    var deleteTenant = function(tenants, callback) {
        var ports = [];
        $.each(tenants, function(index, tenant) {
            ports.push(tenant.port);
        });

        $.ajax({
            url: '/api/tenant/delete',
            type: 'POST',
            data: {
                'tenants': ports
            },
            success: function(data) {
                if ($.isFunction(callback)) {
                    callback(true);
                }
            }, error: function() {
                if ($.isFunction(callback)) {
                    callback();
                }
            }
        });
    };

    /**
     * Starts or stops a tenant server
     * @param {Object}    tenants   Array of tenants to be started/stopped
     * @param {Boolean}   isStart   If set to true the tenants need to be started
     * @param {Function}  callback  Executed after the tenants have been started/stopped
     */
    var startStopTenant = function(tenants, isStart, callback) {
        var ports = [];
        $.each(tenants, function(index, tenant) {
            ports.push(tenant.port);
        });

        var url = '/api/tenant/stop';
        if (isStart) {
            url = '/api/tenant/start';
        }

        $.ajax({
            url: url,
            type: 'POST',
            data: {
                'tenants': ports
            },
            success: function(data) {
                if ($.isFunction(callback)) {
                    callback(true);
                }
            }, error: function() {
                if ($.isFunction(callback)) {
                    callback();
                }
            }
        });
    };


    ///////////////////////
    //// DATA FETCHING ////
    ///////////////////////

    /**
     * Gets the configuration for the tenant (includes all module and tenant configuration)
     * @param {Function} callback Callback function executed after the request completes. Passes through the returned data
     */
    var getConfiguration = function(adminContext, callback) {
        var url = '/api/config';
        // Tenant and global servers do not need the tenantId to be specified in the URL
        // If a tenant server is accessed through the global server the tenantId needs to be specified
        if (!adminContext.tenant.isMainTenantServer) {
            url += '/' + adminContext.tenant.tenantId;
        }

        $.ajax({
            url: url,
            success: function(data) {
                if ($.isFunction(callback)) {
                    callback(data);
                }
            }
        });
    };

    /**
     * Gets the data for tenants
     * @param {Function} callback Callback function executed after the request completes. Passes through the returned data
     */
    var getTenants = function(callback) {
        $.ajax({
            url: '/api/tenants',
            success: function(data) {
                if ($.isFunction(callback)) {
                    callback(data);
                }
            }
        });
    };
