var groupAPI = require('./api.js');

module.exports = function(tenant) {

    tenant.server.get('/api/groups/create', function(req, res) {
        groupAPI.createGroup(tenant, req.query.name, req.query.description, function(err, id) {
            if (err) {
                return res.send(err.code, err.msg);
            }

            res.send(201, {'id': id});
        });
    });

    tenant.server.get('/api/groups/:id', function(req, res) {
        groupAPI.getGroup(req.params.id, function(err, group) {
            if (err) {
                return res.send(err.code, err.msg);
            }

            groupAPI.getGroupMembers(req.params.id, true, function(err, members) {
                if (err) {
                    return res.send(err.code, err.msg);
                }

                group.members = members;
                res.send(group);
            });
        });
    });

    tenant.server.get('/api/groups/:id/members', function(req, res) {
        groupAPI.getGroupMembers(req.params.id, true, function(err, members) {
            if (err) {
                return res.send(err.code, err.msg);
            }

            res.send(members);
        });
    });

    tenant.server.get('/api/groups/:id/add', function(req, res) {
        if (!req.query.principals) {
            return res.send(400, "No principals were specified.");
        }

        groupAPI.addGroupMembers(req.params.id, req.query.principals, function(err, members) {
            if (err) {
                return res.send(err.code, err.msg);
            }

            res.send(200);
        });
    });
};