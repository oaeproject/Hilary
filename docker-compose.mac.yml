#
# Copyright 2017 Apereo Foundation (AF) Licensed under the
# Educational Community License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may
# obtain a copy of the License at
#
#     http://opensource.org/licenses/ECL-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an "AS IS"
# BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
# or implied. See the License for the specific language governing
# permissions and limitations under the License.
#

#
# Setup in two steps
#
# docker-compose create --build
# docker-sync-stack start
#

version: '2'

networks:
  my_network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/24

volumes:
#   oae-hilary-sync:
    # external: true
#   oae-hilary-files-sync:
    # external: true
#   oae-hilary-tmp-sync:
    # external: true
#   oae-elasticsearch-sync:
    # external: true
#   oae-nginx-sync1:
    # external: true
#   oae-nginx-sync2:
    # external: true
#   oae-nginx-sync3:
    # external: true
#   oae-cassandra-sync:
    # external: true
#   oae-etherpad-sync:
    # external: true
#   oae-portainer-sync:
    # external: true

services:
#   oae-hilary:
    # build:
    #   context: .
    #   dockerfile: Dockerfile
    # container_name: oae-hilary
    # depends_on:
    #   - oae-cassandra
    #   - oae-elasticsearch
    #   - oae-rabbitmq
    #   - oae-redis
    #   - oae-etherpad
    # extra_hosts:
    #   - "admin.oae.com:172.20.0.9"
    # image: hilary:latest
    # networks:
    #   my_network:
        # ipv4_address: 172.20.0.7
    # ports:
    #   - 2000:2000
    #   - 2001:2001
    # tty: false
    # volumes:
    #   - oae-hilary-sync:/usr/src/Hilary:rw
    #   - oae-hilary-files-sync:/usr/src/files:rw
    #   - oae-hilary-tmp-sync:/tmp/oae:rw
  oae-redis:
    container_name: oae-redis
    image: redis:3.2.8-alpine
    ports:
      - 6379:6379
    tty: false
    networks:
      - my_network
  oae-elasticsearch:
    container_name: oae-elasticsearch
    image: barnybug/elasticsearch:1.1.2
    networks:
      - my_network
    ports:
      - 9200:9200
    tty: false
    # volumes:
    #   - oae-elasticsearch-sync:/data:rw
  oae-rabbitmq:
    container_name: oae-rabbitmq
    image: rabbitmq:3.6.6-management-alpine
    ports:
      - 5672:5672
    networks:
      - my_network
    tty: false
  oae-nginx:
    container_name: oae-nginx
    # depends_on:
    #   - oae-hilary
    image: nginx:stable-alpine
    networks:
      my_network:
        ipv4_address: 172.20.0.9 # this is needed because of multi-tenancy
    tty: false
    # volumes:
    #   - /nginx.conf.docker:/etc/nginx/nginx.conf:ro
    #   - /mime.conf:/etc/nginx/mime.conf:ro
    #   - /nginx-selfsigned.crt:/etc/nginx/nginx-selfsigned.crt:ro
    #   - /nginx-selfsigned.key:/etc/nginx/nginx-selfsigned.key:ro
    #   - /self-signed.conf:/etc/nginx/self-signed.conf:ro
    #   - /ssl-params.conf:/etc/nginx/ssl-params.conf:ro
    #   - /dhparam.pem:/etc/nginx/dhparam.pem:ro
#       - oae-nginx-sync1:/usr/share/files
#       - oae-nginx-sync2:/usr/share/3akai
#       - oae-nginx-sync3:/etc/nginx
    # volumes_from:
    #   - oae-hilary
    ports:
      - 80:80
      - 443:443
  oae-cassandra:
    container_name: oae-cassandra
    image: oaeproject/cassandra-docker
    networks:
      - my_network
    ports:
      - 9160:9160
      - 9042:9042
    tty: false
    # volumes:
    #   - oae-cassandra-sync:/var/lib/cassandra:rw
  oae-etherpad:
    container_name: oae-etherpad
    depends_on:
      - oae-rabbitmq
    image: oaeproject/oae-etherpad
    networks:
      my_network:
        ipv4_address: 172.20.0.6
    ports:
      - 9001:9001
    tty: false
    # volumes:
    #   - oae-etherpad-sync:/opt/etherpad/var:rw
