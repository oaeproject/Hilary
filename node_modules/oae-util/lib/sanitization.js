/*!
 * Copyright 2014 Apereo Foundation (AF) Licensed under the
 * Educational Community License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License. You may
 * obtain a copy of the License at
 *
 *     http://opensource.org/licenses/ECL-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an "AS IS"
 * BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

var Encoder = require('node-html-encoder').Encoder;

/**
 * Sanitize user input by escaping all HTML characters, making it safe to use the output inside of an HTML tag.
 * We only allow line breaks in the output by converting `\n` to proper HTML tags
 * @see https://github.com/minchenkov/node-html-encoder
 *
 * @param  {String}  value    The input string for which the HTML characters need to be escaped. If this is not provided, an empty string will be returned
 * @return {String}           The input string after the HTML characters have been escaped
 */
module.exports.encodeForHTML = function(value) {
    if (value) {
        var encoder = new Encoder('entity');
        value = encoder.htmlEncode(value);
        value = value.replace(/&#10;/g,'<br/>');
        return value;
    }
    return '';
};

/**
 * Sanitize user input in a manner that it makes safe for the input to be used as a URL fragment
 *
 * @param  {String}  value    The user input string that should be sanitized. If this is not provided, an empty string will be returned
 * @return {String}           The sanitized user input, ready to be used as a URL fragment
 */
module.exports.encodeForURL = function(value) {
    if (value) {
        return encodeURIComponent(value);
    }
    return '';
};
