var Context = require('oae-context').Context;
var principalApi = require('oae-principals');
var User = require('oae-principals/lib/model').User;
var Tenant = require('oae-tenants/lib/model').Tenant;


var tenant = new Tenant('cam', 'Cambridge', 'Cambridge', 2001, 'oae.google.ca');

module.exports.testContextBaseData = function(test) {
    var user = new User(tenant, 'u:cam:physx', 'physx', 'public', 'en_GB', 'Europe/London', 'Bert', 'Pareyn', 'PhysX');
    var ctx = new Context(tenant, user);
    test.equal(ctx.tenant().alias, 'cam');
    test.equal(ctx.user().id, 'u:cam:physx');
    test.done();
}


module.exports.testIsAdmin = function(test) {
    var r = Math.floor(Math.random()*100000);
    var user = new User(tenant, undefined, 'bert-' + r, 'public', 'en_GB', 'Europe/London', 'Bert', 'Pareyn', 'PhysX');
    var ctx = new Context(tenant, null);
    principalApi.createUser(ctx, user.username, 'password', user.visibility, user.locale, user.timezone, user.firstName, user.lastName, user.displayName, function(err, user_id) {
        test.ok(!err);

        user.id = user_id;
        ctx = new Context(tenant, user);
        principalApi.makeUserTenantAdmin(ctx, user, function(err) {
            test.ok(!err);

            ctx.isAdmin(function(err, isAdmin) {
                test.ok(!err);
                test.ok(isAdmin);
                ctx.isTenantAdmin(function(err, isAdmin) {
                    test.ok(!err);
                    test.ok(isAdmin);
                    ctx.isGlobalAdmin(function(err, isAdmin) {
                        test.ok(!err);
                        test.ok(!isAdmin);
                        test.done();
                    });
                });

            });
        })
    });
};