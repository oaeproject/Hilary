var OAE = require('oae-util/lib/OAE');

/**
 * Ensures that the Role schema is active. If it has already been created, this will have no effect.
 *
 * @param {Function} callback A function(err) that specifies whether or not the operation was successful
 */
module.exports.ensureSchema = function(callback) {
    OAE.runQuery('create columnfamily Role (principal text primary key)', false, function (err) {

        // if the column family existed, it's not a real error.
        if (err && err.why && err.why.indexOf('existing column family') > -1) {
            err = false;
        }

        // if a callback was specified, let them handle the error.
        if (callback) {
            callback(err);
        } else if (err) {
            throw err;
        }

    });
};

/**
 * Drop the roles schema, and all its associated data.
 * 
 * @param {Function} callback A function(err) that specifies whether or not the operation was successful
 */
module.exports.dropSchema = function(callback) {
    OAE.runQuery('drop columnfamily Role', false, function(err) {

        // if the column family did not exist, it's not a real error
        if (err && err.why && err.why.indexOf('non existing column family') > -1) {
            err = false;
        }

        if (callback) {
            callback(err);
        } else if (err) {
            throw err;
        }
    });
}