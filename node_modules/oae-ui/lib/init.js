/*!
 * Copyright 2012 Sakai Foundation (SF) Licensed under the
 * Educational Community License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License. You may
 * obtain a copy of the License at
 *
 *     http://www.osedu.org/licenses/ECL-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an "AS IS"
 * BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

var fs = require('fs');
var log = require('oae-logger').logger('oae-ui-init');
var UIAPI = require('./api');

module.exports = function(config, callback) {
    var uiDirectory = fs.realpathSync(config.ui.path);
    var hashes = null;
    var hashesPath = config.ui.hashesPath;
    if (hashesPath) {
        try {
            hashes = require(uiDirectory + '/' + hashesPath);
            log().trace({'hashes': hashes}, 'Initializing UI module with hash mappings');
        } catch (ex) {
            hashes = null;
            if (process.env['NODE_ENV'] === 'production') {
                // Only care about warning for this in production
                log().warn({'err': ex}, 'A path mapping file was configured to an invalid hashes file. Ignoring.');
            } else {
                log().trace({'err': ex}, 'A path mapping file was configured to an invalid hashes file. Ignoring.');
            }
        }
    }

    UIAPI.init(uiDirectory, hashes, callback);
};
