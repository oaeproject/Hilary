var cassandra = require('oae-util/lib/cassandra');

module.exports.testKeyspaceExists = function(test) {
    test.expect(6);

    var keyspace = "keyspacetest" + Math.floor(Math.random()*100000000);
    cassandra.createKeyspace(keyspace, function(err, created) {
        test.ok(!err);
        test.ok(created);

        cassandra.keyspaceExists(keyspace, function(err, exists) {
            test.ok(!err);
            test.ok(exists);

            cassandra.dropKeyspace(keyspace, function(err, dropped) {
                test.ok(!err);
                test.ok(dropped);

                test.done();
            });
        });
    });
};

module.exports.testColumnFamily = function(test) {
    test.expect(8);

    var name = "cf" + Math.floor(Math.random()*10000000);
    cassandra.createColumnFamilyIfNotExists(name, "create table " + name + " (key_id text primary key)", function(err, created) {
        test.ok(!err);
        test.ok(created);

         // Check if it exists.
        cassandra.columnFamilyExists(name, function(err, exists) {
            test.ok(!err);
            test.ok(exists);

            // Drop it.
            cassandra.dropColumnFamily(name, function(err, dropped) {
                test.ok(!err);
                test.ok(dropped);

                // Make sure it's gone.
                cassandra.columnFamilyExists(name, function(err, exists) {
                    test.ok(!err);
                    test.ok(!exists);

                    test.done();
                });
            });
        });
    })
};