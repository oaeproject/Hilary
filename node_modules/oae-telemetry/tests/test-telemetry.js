/*
 * Copyright 2013 Apereo Foundation (AF) Licensed under the
 * Educational Community License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License. You may
 * obtain a copy of the License at
 *
 *     http://opensource.org/licenses/ECL-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an "AS IS"
 * BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

var _ = require('underscore');
var assert = require('assert');

var TelemetryAPI = require('oae-telemetry');


describe('Telemetry', function() {

    var Telemetry = null;
    beforeEach(function() {
        TelemetryAPI.reset('tests');
        Telemetry = TelemetryAPI.telemetry('tests');
    });

    describe('#incr()', function() {

        it('verify it increases by one', function() {
            Telemetry.incr('incr');
            assert.equal(TelemetryAPI.getTelemetryData().counts['tests']['incr'], 1);
        });

        it('verify multiple increases', function() {
            for (var i = 0; i < 10; i++) {
                Telemetry.incr('incr');
            }
            assert.equal(TelemetryAPI.getTelemetryData().counts['tests']['incr'], 10);
        });

    });

    describe('#append()', function() {

        it('verify it appends data to a list', function() {
            Telemetry.append('append', 10);
            assert.equal(TelemetryAPI.getTelemetryData().histograms['tests']['append'].length, 1);
            assert.equal(TelemetryAPI.getTelemetryData().histograms['tests']['append'][0], 10);

            Telemetry.append('append', 5);
            assert.equal(TelemetryAPI.getTelemetryData().histograms['tests']['append'].length, 2);
            assert.equal(TelemetryAPI.getTelemetryData().histograms['tests']['append'][0], 10);
            assert.equal(TelemetryAPI.getTelemetryData().histograms['tests']['append'][1], 5);
        });

    });
});
