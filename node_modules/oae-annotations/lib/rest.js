var OAE = require('oae-util/lib/oae');
var annotationApi = require('./api');

// A handshake used by the annotator to confirm everything is up an running
OAE.tenantServer.get('/api/annotations', function(req, response){
    response.send(200, {"name": "Annotator Store API",  "version": "2.0.0"});
});


// Return all annotations wich can be found on a specific page
OAE.tenantServer.get('/api/annotations/:revisionId/:page', function(req, response){
    annotationApi.getAnnotations(req.ctx, req.params.revisionId, req.params.page, function(err, data){
        if (err){
            response.send(err.code,err.msg);
        } else{
            response.send(200, data);
        }
    });
});


// Request a specific annotation form the server
OAE.tenantServer.get('/api/annotations/:revisionId/:page/:annotationId', function(req, response){
    annotationApi.getAnnotation(req.ctx, req.params.revisionId, req.params.annotationId, function(err, data){
        if (err){
            response.send(err.code,err.msg);
        } else{
            response.send(200,data);
        }
    });
});

// Create a new annotation
OAE.tenantServer.post('/api/annotations/:revisionId/:page', function(req, response){
    annotationApi.createAnnotation(req.ctx, req.params.revisionId, req.params.page, req.body, function(err, data){
        if (err){
            response.send(err.code,err.msg);
        }else{
            response.setHeader('location', data);
            response.send(303);
        }
    });
});


// Update a annotation
OAE.tenantServer.put('/api/annotations/:revisionId/:page/:annotationId', function(req, response){
    annotationApi.updateAnnotation(req.ctx, req.params.revisionId, req.params.page, req.params.annotationId, req.body, function(err, data){
        if (err){
            response.send(err.code,err.msg);
        }else{
            response.setHeader('location', data);
            response.send(303);
        }
    });  
});

// Delete a annotation
OAE.tenantServer.delete('/api/annotations/:revisionId/:annotationId', function(req, response){ 
    annotationApi.deleteAnnotation(req.ctx, req.params.revisionId, req.params.annotationId, function(err){
        if (err){
            response.send(err.code,err.msg);
        }else{
            response.send(204);
        }
    }); 
});


