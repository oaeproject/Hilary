/*
 * Copyright 2012 Sakai Foundation (SF) Licensed under the
 * Educational Community License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License. You may
 * obtain a copy of the License at
 *
 *     http://www.osedu.org/licenses/ECL-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an "AS IS"
 * BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

var request = require('request');

var TestUserAPI = require('./api.user');
var TenantAPI = require('oae-tenants');


// Stopping a server is async, this variable
// holds how long we should wait before returning on start/stop/delete
// of a tenant.
var WAIT_TIME = 1000;

var createTenant = module.exports.createTenant = function(tenant, callback) {
    // Todo: authentication once that gets merged in.
    request.post({
            'uri': 'http://localhost:2000/api/tenant/create',
            'json': {
                'id': tenant.alias,
                'name': tenant.name,
                'description': tenant.description,
                'port': tenant.port,
                'baseurl': tenant.baseUrl
            }
        }, callback);
};

var stopTenants = module.exports.stopTenants = function(tenants, callback) {
    // Todo: authentication once that gets merged in.
    request.post({
        'uri': 'http://localhost:2000/api/tenant/stop',
        'form': {
            'tenants': tenants
        }
    }, function(err, response, body) {
        setTimeout(function() {
            callback(err, response, body);
        }, WAIT_TIME);
    });
};

var startTenants = module.exports.startTenants = function(tenants, callback) {
    // Todo: authentication once that gets merged in.
    request.post({
        'uri': 'http://localhost:2000/api/tenant/start',
        'form': {
            'tenants': tenants
        }
    }, function(err, response, body) {
        setTimeout(function() {
            callback(err, response, body);
        }, WAIT_TIME);
    });
};

var deleteTenants = module.exports.deleteTenants = function(tenants, callback) {
    // Todo: authentication once that gets merged in.
    request.post({
        'uri': 'http://localhost:2000/api/tenant/delete',
        'form': {
            'tenants': tenants
        }
    }, function(err, response, body) {
        setTimeout(function() {
            callback(err, response, body);
        }, WAIT_TIME);
    });
};