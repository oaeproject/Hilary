var Cassandra = require('oae-util/lib/cassandra');

var api = require('oae-tenants/lib/api');
var schema = require('oae-tenants/lib/schema');

// Verify that a tenant can be accessed by their mapped port
module.exports.testGetTenantByPort = function(test) {
    test.expect(10);

    api.getTenantByPort(2001, function(err, tenant) {
        test.ok(!err);
        test.equal(2001, tenant.port);
        test.equal('camtest', tenant.alias);
        test.equal('Cambridge University Test', tenant.name);
        test.equal('Cambridge University Description', tenant.description);
        api.getTenantByPort(2002, function(err, tenant) {
            test.ok(!err);
            test.equal(2002, tenant.port);
            test.equal('gttest', tenant.alias);
            test.equal('Georgia Tech Test', tenant.name);
            test.equal('Georgia Tech Description', tenant.description);
            test.done();
        });
    });
    
};

// Verify that a tenant can be accessed by their mapped alias
module.exports.testGetTenantByAlias = function(test) {
    test.expect(10);

    api.getTenantByAlias('camtest', function(err, tenant) {
        test.ok(!err);
        test.equal(2001, tenant.port);
        test.equal('camtest', tenant.alias);
        test.equal('Cambridge University Test', tenant.name);
        test.equal('Cambridge University Description', tenant.description);
        api.getTenantByAlias('gttest', function(err, tenant) {
            test.ok(!err);
            test.equal(2002, tenant.port);
            test.equal('gttest', tenant.alias);
            test.equal('Georgia Tech Test', tenant.name);
            test.equal('Georgia Tech Description', tenant.description);
            test.done();
        });
    });
};

// Verify that a tenant is correctly created
module.exports.testCreateTenant = function(test) {
    test.expect(10);

    api.createTenant('rsmarttest', 'rSmart Test', 'rSmart Description', 2003, function(err, tenant) {
        test.ok(tenant);
        test.equal('rsmarttest', tenant.alias);
        test.equal('rSmart Test', tenant.name);
        test.equal('rSmart Description', tenant.description);
        test.equal(2003, tenant.port);
        api.getTenantByPort(2003, function(err, tenant) {
            test.ok(tenant);
            test.equal('rsmarttest', tenant.alias);
            test.equal('rSmart Test', tenant.name);
            test.equal('rSmart Description', tenant.description);
            test.equal(2003, tenant.port);
            test.done();
        });
    });
};

// verify that a tenant cannot be created with a duplicate port
module.exports.testCannotCreateDuplicatePort = function(test) {
    test.expect(6);
    api.createTenant('testCannotCreateDuplicatePort', 'Test Tenant', 'A tenant for testing', 2001, function(err, tenant) {
        test.ok(err);
        api.getTenantByPort(2001, function(err, tenant) {
            test.ok(!err);
            test.equal(2001, tenant.port);
            test.equal('camtest', tenant.alias);
            test.equal('Cambridge University Test', tenant.name);
            test.equal('Cambridge University Description', tenant.description);
            test.done();
        });
    });
};

// verify that a tenant cannot be created with a duplicate alias
module.exports.testCannotCreateDuplicateAlias = function(test) {
    test.expect(7);
    api.createTenant('camtest', 'Test Tenant', 'A tenant for testing', 2004, function(err, tenant) {
        test.ok(err);
        api.getTenantByPort(2004, function(err, tenant) {
            test.ok(err);
            api.getTenantByAlias('camtest', function(err, tenant) {
                test.ok(!err);
                test.equal(2001, tenant.port);
                test.equal('camtest', tenant.alias);
                test.equal('Cambridge University Test', tenant.name);
                test.equal('Cambridge University Description', tenant.description);
                test.done();
            });
        });
    });
};
