/*
 * Copyright 2014 Apereo Foundation (AF) Licensed under the
 * Educational Community License, Version 2.0 (the 'License'); you may
 * not use this file except in compliance with the License. You may
 * obtain a copy of the License at
 *
 *     http://opensource.org/licenses/ECL-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an 'AS IS'
 * BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

var assert = require('assert');

var OaeUtil = require('oae-util/lib/util');

describe('OAE Util', function() {

    describe('#getNumberParam', function() {

        it('verifies a variety of inputs for getNumberParam', function(callback) {

            // Verify valid inputs are successful
            assert.equal(OaeUtil.getNumberParam(1), 1);
            assert.equal(OaeUtil.getNumberParam('1'), 1);

            // Verify invalid inputs fall back to undefined when defaultVal is not defined
            assert.equal(OaeUtil.getNumberParam(''), undefined);
            assert.equal(OaeUtil.getNumberParam(' '), undefined);
            assert.equal(OaeUtil.getNumberParam(true), undefined);
            assert.equal(OaeUtil.getNumberParam(false), undefined);
            assert.equal(OaeUtil.getNumberParam({}), undefined);
            assert.equal(OaeUtil.getNumberParam([]), undefined);
            assert.equal(OaeUtil.getNumberParam(null), undefined);
            assert.equal(OaeUtil.getNumberParam(undefined), undefined);
            assert.equal(OaeUtil.getNumberParam(), undefined);

            // Verify valid inputs do not fall back to valid defaultVal
            assert.equal(OaeUtil.getNumberParam(1, 5), 1);
            assert.equal(OaeUtil.getNumberParam('1', 5), 1);

            // Verify invalid inputs fall back to defaultVal when valid
            assert.equal(OaeUtil.getNumberParam('', 5), 5);
            assert.equal(OaeUtil.getNumberParam(' ', 5), 5);
            assert.equal(OaeUtil.getNumberParam(true, 5), 5);
            assert.equal(OaeUtil.getNumberParam(false, 5), 5);
            assert.equal(OaeUtil.getNumberParam({}, 5), 5);
            assert.equal(OaeUtil.getNumberParam([], 5), 5);
            assert.equal(OaeUtil.getNumberParam(null, 5), 5);
            assert.equal(OaeUtil.getNumberParam(undefined, 5), 5);

            // Verify invalid inputs fall back to defaultVal, regardless of its value
            assert.equal(OaeUtil.getNumberParam(null, '1'), '1');
            assert.equal(OaeUtil.getNumberParam(null, ''), '');
            assert.equal(OaeUtil.getNumberParam(null, ' '), ' ');
            assert.equal(OaeUtil.getNumberParam(null, true), true);
            assert.equal(OaeUtil.getNumberParam(null, false), false);
            assert.equal(OaeUtil.getNumberParam(null, {'test': 'worked'}).test, 'worked');
            assert.equal(OaeUtil.getNumberParam(null, ['test'])[0], 'test');
            assert.equal(OaeUtil.getNumberParam(null, null), null);
            assert.equal(OaeUtil.getNumberParam(null, undefined), undefined);

            // Verify lower bounding.
            assert.equal(OaeUtil.getNumberParam(-10, 2, 0, 5), 0);
            assert.equal(OaeUtil.getNumberParam('-10', 2, 0, 5), 0);
            assert.equal(OaeUtil.getNumberParam(-10, 2, 1, 5), 1);
            assert.equal(OaeUtil.getNumberParam('-10', 2, 1, 5), 1);

            // Verify upper bounding
            assert.equal(OaeUtil.getNumberParam(10, 2, 0, 5), 5);
            assert.equal(OaeUtil.getNumberParam('10', 2, 0, 5), 5);
            assert.equal(OaeUtil.getNumberParam(10, 2, -100, 0), 0);
            assert.equal(OaeUtil.getNumberParam('10', 2, -100, 0), 0);

            return callback();
        });
    });
});