/*!
 * Copyright 2012 Sakai Foundation (SF) Licensed under the
 * Educational Community License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License. You may
 * obtain a copy of the License at
 *
 *     http://www.osedu.org/licenses/ECL-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an "AS IS"
 * BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

var IO = require('oae-util/lib/io');
var dox = require('dox');
var fs = require('fs');

/**
 * Parse module doc into json
 *
 * @param {string}          moduleId        The module to get docs for
 * @param {Function}        callback        The function to call when complete
 */
module.exports.getDoc = function(moduleId, callback) {
    var dir = 'node_modules/' + moduleId + '/lib';
    IO.getFileListForFolder(dir, function(libs) {
        var doc = {};
        for (var i=0; i < libs.length; i++) {
            var lib = libs[i];
            var data = fs.readFileSync(dir + "/" + lib, 'utf-8');
            doc[lib] = dox.parseComments(data);
        }
        callback(doc);
    });    
};
